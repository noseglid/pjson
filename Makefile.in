CXX       = @CXX@
CXXFLAGS  = @CXXFLAGS@
CXXFLAGS +=-DVERSION=@PACKAGE_VERSION@ -DPACKAGE_NAME=@PACKAGE_NAME@

LIBTOOL = @LIBTOOL@
INSTALL = @INSTALL@
RM      = @RM@
PRINTF  = @@PRINTF@

LIB     = libpjson.la
SOURCES = pjson/JsonValue.cpp
OBJECTS = $(SOURCES:.cpp=.lo)
HEADERS = $(SOURCES:.cpp=.hpp) pjson/JsonException.hpp pjson/pjson.hpp

PREFIX = @prefix@
LIBDIR = @prefix@/lib
INCDIR = @prefix@/include/pjson

VERSION = @PACKAGE_VERSION@

.PHONY: all install uninstall doc test clean

all: $(LIB)

$(LIB): $(OBJECTS)
	$(LIBTOOL) --mode=link $(CXX) $(CXXFLAGS) -o $(LIB) $(OBJECTS) \
	           -rpath $(LIBDIR) -release $(VERSION)

install: $(LIB)
	$(INSTALL) -d $(LIBDIR)
	$(INSTALL) -d $(INCDIR)
	$(LIBTOOL) --quiet --mode=install $(INSTALL) $(LIB) $(LIBDIR)
	$(LIBTOOL) --quiet --mode=install $(INSTALL) $(HEADERS) $(INCDIR)
	$(LIBTOOL) --mode=finish -n $(LIBDIR)
	$(PRINTF)  -- "Don't forget to run 'make test' to make sure library was installed and works properly.\n"

uninstall:
	$(LIBTOOL) --mode=uninstall $(RM) $(LIBDIR)/$(LIB)
	$(LIBTOOL) --mode=uninstall $(RM) $(HEADERS:%=$(INCDIR)/%)

doc:
	$(MAKE) -C doc

test: $(LIB)
	$(MAKE) -C tests test

clean:
	$(LIBTOOL) --mode=clean $(RM) -f $(OBJECTS)
	$(LIBTOOL) --mode=clean $(RM) -f $(LIB)
	$(MAKE) -C doc clean
	$(MAKE) -C tests clean

%.lo: %.cpp
	$(LIBTOOL) --mode=compile $(CXX) $(CXXFLAGS) -c $< -o $@
